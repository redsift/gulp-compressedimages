
machine:
  node:
    version: 6.3.1
  environment:
    NAME: gulp-compressedimages

checkout:
  pre:
    - npm install -g npm
    - |
        cd /tmp
        mkdir imagemagick
        cd imagemagick
        sudo apt-get update && sudo apt-get build-dep imagemagick
        sudo apt-get install libwebp-dev devscripts
        apt-get source imagemagick
        cd imagemagick-*
        debuild -uc -us
        sudo dpkg -i ../*magick*.deb    

dependencies:
  override:
    - npm install

test:
  override:
    - npm test

deployment:
  production:
    branch: /release-.*/
    commands:
      - echo "Publishing to NPM"
      - echo -e "$NPM_USERNAME\n$NPM_PASSWORD\n$NPM_EMAIL" | npm login
      - npm publish --access=public